# Custom Dockerfile for N8N with AI Copilot Integration
FROM docker.n8n.io/n8nio/n8n:latest

# Install additional dependencies
USER root
RUN apk add --no-cache python3 py3-pip

# Install AI/ML libraries
RUN pip3 install --no-cache-dir openai anthropic langchain tiktoken

# Create copilot service directory
RUN mkdir -p /opt/copilot-service
COPY copilot-service/ /opt/copilot-service/

# Install copilot service dependencies
WORKDIR /opt/copilot-service
RUN npm install

# Copy startup script
COPY start-with-copilot.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/start-with-copilot.sh

# Switch back to n8n user
USER node

# Set working directory back to n8n
WORKDIR /home/node

# Expose additional port for copilot service
EXPOSE 3001

# Use custom startup script
ENTRYPOINT ["/usr/local/bin/start-with-copilot.sh"]
